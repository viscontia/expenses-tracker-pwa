import{r as x,t as b,j as e}from"./index-DRQOx_Xf.js";import{T as w,C as v}from"./trending-up-BLktqF8c.js";import{I as k,C as U,a as C}from"./info-DJPN9HXl.js";import{L as $}from"./loader-circle-CIeghaF9.js";function M({position:m="header",showDetails:j=!1,className:l=""}){const[t,r]=x.useState({isHealthy:!0,lastUpdate:null,daysSinceUpdate:0,needsUpdate:!1,isLoading:!0,error:null}),[y,u]=x.useState(!1),{data:n,isLoading:g,error:o,refetch:S}=b.currency.getLastExchangeRateUpdate.useQuery(void 0,{refetchInterval:6e4,refetchOnWindowFocus:!0,retry:2}),{data:i}=b.currency.getCacheMetrics.useQuery(void 0,{refetchInterval:12e4,refetchOnWindowFocus:!1,retry:1});x.useEffect(()=>{if(g){r(s=>({...s,isLoading:!0,error:null}));return}if(o){r({isHealthy:!1,lastUpdate:null,daysSinceUpdate:999,needsUpdate:!0,isLoading:!1,error:o.message||"Failed to check exchange rates"});return}if(n?.success&&n.lastUpdateDate){const s=new Date(n.lastUpdateDate),p=Math.floor((new Date().getTime()-s.getTime())/(1e3*60*60*24)),f=new Date;f.setHours(0,0,0,0);const N=s<f;r({isHealthy:p<=1,lastUpdate:s,daysSinceUpdate:p,needsUpdate:N,isLoading:!1,error:null})}else r({isHealthy:!1,lastUpdate:null,daysSinceUpdate:999,needsUpdate:!0,isLoading:!1,error:"No exchange rate data available"})},[n,g,o]);const a=t.isLoading?{icon:$,color:"text-blue-500",bgColor:"bg-blue-100 dark:bg-blue-900/20",label:"Verificando..."}:t.error?{icon:U,color:"text-red-500",bgColor:"bg-red-100 dark:bg-red-900/20",label:"Errore valute"}:t.needsUpdate?{icon:v,color:"text-amber-500",bgColor:"bg-amber-100 dark:bg-amber-900/20",label:"Da aggiornare"}:{icon:C,color:"text-green-500",bgColor:"bg-green-100 dark:bg-green-900/20",label:"Aggiornati"},c=a.icon,h=()=>{if(!t.lastUpdate)return"Mai aggiornati";const d=Math.floor((new Date().getTime()-t.lastUpdate.getTime())/(1e3*60*60));return d<1?"Da poco":d<24?`${d}h fa`:`${t.daysSinceUpdate} giorni fa`};return m==="header"?e.jsxs("div",{className:`relative ${l}`,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[e.jsxs("div",{className:`flex items-center space-x-2 px-2 py-1 rounded-lg ${a.bgColor} border border-opacity-20`,children:[e.jsx(c,{className:`h-4 w-4 ${a.color} ${t.isLoading?"animate-spin":""}`}),e.jsx("span",{className:`text-xs font-medium ${a.color}`,children:"ðŸ’±"})]}),y&&e.jsxs("div",{className:"absolute top-full left-0 mt-2 z-50 w-96 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-xl shadow-xl p-5",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(w,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white text-base",children:"Tassi di Cambio"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between py-2 px-1",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 font-medium",children:"Stato:"}),e.jsx("span",{className:"text-gray-900 dark:text-white font-semibold",children:a.label})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 px-1",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 font-medium",children:"Aggiornato:"}),e.jsx("span",{className:"text-gray-900 dark:text-white font-semibold",children:h()})]}),i?.success&&i.status&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-center justify-between py-2 px-1",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-sm font-medium",children:"Cache:"}),e.jsxs("span",{className:"text-blue-600 dark:text-blue-400 font-semibold text-sm",children:[i.status.size," entries, ",Math.round(i.status.hitRate*100),"%"]})]})}),t.error&&e.jsx("div",{className:"mt-4 pt-4 border-t border-red-200 dark:border-red-600",children:e.jsx("p",{className:"text-red-500 text-sm font-medium",children:t.error})})]})]})]}):m==="dashboard"?e.jsxs("div",{className:`${a.bgColor} border border-opacity-20 rounded-lg p-4 ${l}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(c,{className:`h-5 w-5 ${a.color} ${t.isLoading?"animate-spin":""}`}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Tassi di Cambio"})]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${a.bgColor} ${a.color} font-medium`,children:a.label})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Aggiornamento:"}),e.jsx("span",{className:t.needsUpdate?"text-amber-600 dark:text-amber-400":"",children:h()})]}),t.lastUpdate&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Data:"}),e.jsx("span",{children:t.lastUpdate.toLocaleDateString("it-IT")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Stato:"}),e.jsx("span",{className:`${a.color} font-medium`,children:t.isHealthy?"Sano":"Richiede attenzione"})]})]}),t.error&&e.jsx("div",{className:"mt-3 p-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded text-red-600 dark:text-red-400 text-xs",children:t.error})]}):e.jsxs("div",{className:`flex items-center space-x-3 p-2 rounded-lg ${a.bgColor} ${l}`,children:[e.jsx(c,{className:`h-4 w-4 ${a.color} ${t.isLoading?"animate-spin":""}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:"Tassi valute"}),e.jsx("p",{className:`text-xs ${a.color}`,children:a.label})]}),j&&e.jsx(k,{className:"h-3 w-3 text-gray-400"})]})}export{M as E};
