import{r as s,t as v,b as ge,a as J,j as e}from"./index-DRQOx_Xf.js";import{C as xe,L as pe,a as fe}from"./lucide-react-Df_vrqSX.js";import{u as be,T as he,U as ye}from"./UnsavedChangesModal-WPjUveF1.js";import{e as ve}from"./ExchangeRateNotifications-D8l0R8K0.js";import{f as ke}from"./formatters-BSk7yeV2.js";import{L as B}from"./loader-circle-CIeghaF9.js";import{A as W,D as X,C as Z}from"./dollar-sign-Bgq7nrk_.js";import{C as je}from"./calendar-D2ZVVomX.js";import{F as Ne}from"./file-text-GkSa6YAt.js";function we(a={}){const{enabled:g=!0,timeoutMs:b=5e3,onUpdateStart:T,onUpdateComplete:E,onUpdateError:L}=a,[u,f]=s.useState({isChecking:!1,isUpdating:!1,lastCheckTime:null,needsUpdate:null,updateComplete:!1,error:null}),n=s.useRef(null),x=s.useRef(!1),O=v.currency.getLastExchangeRateUpdate.useQuery(void 0,{enabled:!1,refetchOnWindowFocus:!1,refetchOnMount:!1,retry:1}),S=v.currency.updateDailyExchangeRates.useMutation({onMutate:()=>{console.log("ðŸ’± [PreSubmit] Starting exchange rate update..."),f(t=>({...t,isUpdating:!0,error:null})),T?.()},onSuccess:t=>{console.log("ðŸ’± [PreSubmit] Update completed:",t),f(l=>({...l,isUpdating:!1,updateComplete:!0,error:null})),E?.(!0,t),t.updatedRates&&t.updatedRates>0&&ve.success(t.updatedRates)},onError:t=>{const l=t.message||"Update failed";console.error("ðŸ’± [PreSubmit] Update failed:",l),f(i=>({...i,isUpdating:!1,error:l})),L?.(l),E?.(!1)}}),F=s.useCallback(async()=>{if(!g)return!1;try{f(d=>({...d,isChecking:!0,lastCheckTime:new Date,error:null}));const l=(await O.refetch()).data?.lastUpdateDate,i=new Date;i.setHours(0,0,0,0);const c=!l||new Date(l)<i;return f(d=>({...d,isChecking:!1,needsUpdate:c})),console.log(c?"ðŸ’± [PreSubmit] Exchange rates are stale, update needed":"ðŸ’± [PreSubmit] Exchange rates are fresh, no update needed"),c}catch(t){return console.error("ðŸ’± [PreSubmit] Failed to check last update:",t),f(l=>({...l,isChecking:!1,error:"Failed to check update status"})),!1}},[g,O]),P=s.useCallback(async()=>{if(!g||x.current)return{success:!0,updated:!1,timedOut:!1};x.current=!0;try{if(console.log("ðŸ’± [PreSubmit] Ensuring fresh exchange rates..."),f(c=>({...c,updateComplete:!1,error:null})),!await F())return x.current=!1,{success:!0,updated:!1,timedOut:!1};console.log("ðŸ’± [PreSubmit] Starting update with timeout...");const l=S.mutateAsync(),i=new Promise((c,d)=>{n.current=setTimeout(()=>{d(new Error("Update timeout"))},b)});try{const c=await Promise.race([l,i]);return n.current&&(clearTimeout(n.current),n.current=null),console.log("ðŸ’± [PreSubmit] Update completed successfully:",c),x.current=!1,{success:!0,updated:!0,timedOut:!1}}catch(c){return n.current&&(clearTimeout(n.current),n.current=null),c instanceof Error&&c.message==="Update timeout"?(console.warn("ðŸ’± [PreSubmit] Update timed out, proceeding anyway"),x.current=!1,{success:!0,updated:!1,timedOut:!0}):(console.error("ðŸ’± [PreSubmit] Update failed:",c),x.current=!1,{success:!1,updated:!1,timedOut:!1,error:c instanceof Error?c.message:"Unknown error"})}}catch(t){return console.error("ðŸ’± [PreSubmit] Unexpected error:",t),x.current=!1,{success:!1,updated:!1,timedOut:!1,error:t instanceof Error?t.message:"Unknown error"}}},[g,F,S,b]),A=s.useCallback(()=>{n.current&&(clearTimeout(n.current),n.current=null),x.current=!1},[]);return{status:u,ensureFreshRates:P,cleanup:A,isProcessing:u.isChecking||u.isUpdating,hasError:!!u.error,isReady:!u.isChecking&&!u.isUpdating}}const Ee=[{code:"EUR",name:"Euro",symbol:"â‚¬"},{code:"USD",name:"US Dollar",symbol:"$"},{code:"GBP",name:"British Pound",symbol:"Â£"},{code:"ZAR",name:"South African Rand",symbol:"R"},{code:"JPY",name:"Japanese Yen",symbol:"Â¥"},{code:"AUD",name:"Australian Dollar",symbol:"A$"},{code:"CAD",name:"Canadian Dollar",symbol:"C$"},{code:"CHF",name:"Swiss Franc",symbol:"CHF"},{code:"CNY",name:"Chinese Yuan",symbol:"Â¥"},{code:"INR",name:"Indian Rupee",symbol:"â‚¹"}];function Ae({mode:a,expenseId:g}){const b=ge(),T=J(r=>r.token),E=J(r=>r.user?.preferences?.defaultCurrency),L=v.useUtils(),{data:u,isLoading:f}=v.categories.getAll.useQuery(void 0,{enabled:!!T}),{data:n,isLoading:x,error:O}=v.expenses.getExpenseById.useQuery({id:g},{enabled:a==="update"&&!!g&&typeof g=="number",staleTime:5*60*1e3,retry:1}),[S,F]=s.useState("EUR"),P=v.expenses.createExpense.useMutation({onSuccess:()=>{console.log("âœ… [ExpenseForm] Expense saved successfully!"),M(!0),!n&&V?(console.log("ðŸ”„ [ExpenseForm] Resetting form for new expense..."),setTimeout(()=>{l({amount:"",currency:t.currency??"EUR",categoryId:"",date:new Date().toISOString().split("T")[0]||new Date().toISOString().slice(0,10),description:"",conversionRate:void 0}),M(!1),C(!1),U(null),c({})},500)):setTimeout(()=>{console.log("ðŸ”„ [ExpenseForm] Navigating to expenses list..."),b({to:"/expenses"})},500)},onError:r=>{U(r.message),C(!1)}}),A=v.expenses.updateExpense.useMutation({onSuccess:()=>{console.log("âœ… [ExpenseForm] Expense updated successfully!"),M(!0),L.expenses.getExpenses.invalidate(),setTimeout(()=>{console.log("ðŸ”„ [ExpenseForm] Navigating to expenses list..."),b({to:"/expenses"})},500)},onError:r=>{U(r.message),C(!1)}}),[t,l]=s.useState({amount:"",currency:"EUR",categoryId:"",date:new Date().toISOString().split("T")[0]||new Date().toISOString().slice(0,10),description:"",conversionRate:void 0}),[i,c]=s.useState({}),[d,C]=s.useState(!1),[k,M]=s.useState(!1),[Q,U]=s.useState(null),[V,ee]=s.useState(!1),[h,R]=s.useState(!1),[p,I]=s.useState(""),$=s.useRef(null),z=s.useRef(null),N=s.useRef(null),_=r=>pe[r]||fe,D=u?.find(r=>r.id.toString()===t.categoryId),y=s.useMemo(()=>{if(!u)return[];if(!p.trim())return u;const r=p.toLowerCase();return u.filter(o=>o.name.toLowerCase().includes(r)||o.description&&o.description.toLowerCase().includes(r))},[u,p]),{data:j,isLoading:re}=v.currency.getExchangeRate.useQuery({fromCurrency:"EUR",toCurrency:S},{enabled:S!=="EUR",staleTime:5*60*1e3,retry:2}),{ensureFreshRates:te,isProcessing:Y}=we({enabled:a==="update",timeoutMs:3e3,onUpdateStart:()=>{console.log("ðŸ’± [ExpenseForm] Starting exchange rate update before UPDATE...")},onUpdateComplete:(r,o)=>{r&&o&&!o.skipped&&console.log(`ðŸ’± [ExpenseForm] Exchange rates updated successfully: ${o.updatedRates} rates`)},onUpdateError:r=>{console.warn("ðŸ’± [ExpenseForm] Exchange rate update failed, but proceeding with UPDATE:",r)}});s.useEffect(()=>{a==="update"&&n&&(console.log("ðŸ“ [ExpenseForm] Loading existing expense data:",n),l({amount:n.amount.toString(),currency:n.currency,categoryId:n.categoryId.toString(),date:new Date(n.date).toISOString().split("T")[0],description:String(n.description||""),conversionRate:n.conversionRate}))},[a,n]),s.useEffect(()=>{if(a==="insert"){const r=String(E||"EUR");l(o=>({...o,currency:r}))}},[E,a]),s.useEffect(()=>{F(t.currency)},[t.currency]),s.useEffect(()=>{const r=o=>{$.current&&!$.current.contains(o.target)&&(R(!1),I(""))};return h&&document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[h]),s.useEffect(()=>{h&&z.current&&setTimeout(()=>{z.current?.focus()},100)},[h]),s.useEffect(()=>{const r=setTimeout(()=>{N.current&&!d&&!k&&(N.current.focus(),N.current.select())},150);return()=>clearTimeout(r)},[d,k]),s.useEffect(()=>{if(!n&&t.amount===""&&!d&&!k){const r=setTimeout(()=>{N.current&&N.current.focus()},200);return()=>clearTimeout(r)}},[t.amount,n,d,k]);const K=()=>{const r={};return t.amount?(isNaN(parseFloat(t.amount))||parseFloat(t.amount)<=0)&&(r.amount="Importo deve essere un numero positivo"):r.amount="Importo richiesto",t.categoryId||(r.categoryId="Categoria richiesta"),t.date||(r.date="Data richiesta"),c(r),Object.keys(r).length===0},ae=r=>{if(r.key==="Enter"&&!d&&!k){const o=r.target;if(o.tagName==="INPUT"&&o.placeholder==="Cerca categoria per nome..."||o.tagName==="TEXTAREA")return;r.preventDefault(),q(r)}},q=async r=>{if(r.preventDefault(),U(null),!!K()){if(!T){U("Token di autenticazione mancante");return}C(!0);try{console.log(`ðŸ’¾ [ExpenseForm] Starting ${a==="insert"?"INSERT":"UPDATE"} expense...`);let o=Promise.resolve({success:!0,updated:!1,timedOut:!1});a==="update"&&(o=te().catch(H=>(console.warn("âš ï¸ [ExpenseForm] Background rate update failed:",H),{success:!1,updated:!1,timedOut:!1})));let m=1;a==="update"&&t.conversionRate?t.conversionRate!==1?(m=t.conversionRate,console.log(`ðŸ’± [ExpenseForm] UPDATE: Preserving historical rate: ${m}`)):(console.log("ðŸ’± [ExpenseForm] UPDATE: Historical rate was 1.0 (error), updating..."),t.currency!=="EUR"&&j?.rate&&j.rate>0?(m=j.rate,console.log(`ðŸ’± [ExpenseForm] UPDATE: Using current rate ${t.currency}â†’EUR: ${m}`)):(console.warn("âš ï¸ [ExpenseForm] UPDATE: No current rate available, keeping 1.0"),m=1)):t.currency!=="EUR"?(m=j?.rate||1,console.log(`ðŸ’± [ExpenseForm] INSERT: Using DB rate ${t.currency}â†’EUR: ${m}`)):(m=1,console.log("ðŸ’± [ExpenseForm] INSERT: EUR expense, conversion rate: 1.0")),console.log(`ðŸ’¾ [ExpenseForm] ${a==="insert"?"Creating":"Updating"} expense immediately...`);const G={categoryId:parseInt(t.categoryId),amount:parseFloat(t.amount),currency:t.currency,conversionRate:m,date:new Date(t.date).toISOString(),description:t.description||void 0};a==="insert"?await P.mutateAsync(G):await A.mutateAsync({id:g,...G}),o.then(H=>{H.updated&&console.log(`âœ… [ExpenseForm] Background exchange rates updated after ${a}`)})}catch{C(!1)}}},w=(r,o)=>{l(m=>({...m,[r]:o})),i[r]&&c(m=>({...m,[r]:void 0}))},se=s.useMemo(()=>t,[t]),ne=async()=>{if(!K())throw new Error("Form validation failed");const r={categoryId:parseInt(t.categoryId),amount:parseFloat(t.amount),currency:t.currency,conversionRate:t.currency==="EUR"?1:j?.rate||1,date:new Date(t.date).toISOString(),description:t.description||void 0};a==="insert"?await P.mutateAsync(r):await A.mutateAsync({id:g,...r})},{hasUnsavedChanges:oe,isModalOpen:ie,confirmNavigation:ce,cancelNavigation:le,saveAndNavigate:de}=be({formData:se,onSave:ne,isSaving:d,disabled:k,message:a==="insert"?"Hai inserito dei dati per una nuova spesa. Vuoi salvarla prima di uscire?":"Hai modificato questa spesa. Vuoi salvare le modifiche prima di uscire?"});if(a==="update"&&x||f)return e.jsx("div",{className:"flex items-center justify-center min-h-64",children:e.jsxs("div",{className:"flex items-center space-x-2 text-gray-600 dark:text-gray-400",children:[e.jsx(B,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:"Caricamento..."})]})});if(a==="update"&&!x&&!n)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6 text-center",children:[e.jsx("h2",{className:"text-lg font-medium text-red-900 dark:text-red-100 mb-2",children:"Spesa non trovata"}),e.jsxs("p",{className:"text-red-700 dark:text-red-300 mb-4",children:["La spesa con ID ",g," non Ã¨ stata trovata."]}),e.jsx("button",{onClick:()=>b({to:"/expenses"}),className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700",children:"Torna alla lista spese"})]})})});const ue=a==="insert"?"Nuova Spesa":"Modifica Spesa",me=a==="insert"?"Salva Spesa":"Aggiorna Spesa";return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[e.jsx("button",{onClick:()=>b({to:"/expenses"}),className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Torna alla lista spese",children:e.jsx(W,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:ue})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),a==="insert"?"Registrazione nuova spesa":"Modifica spesa esistente"]}),oe&&e.jsxs("div",{className:"flex items-center text-amber-600 dark:text-amber-400",children:[e.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full mr-2"}),e.jsx("span",{children:"Modifiche non salvate"})]})]})}),a==="insert"&&e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 mb-6",children:e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:V,onChange:r=>ee(r.target.checked),className:"w-4 h-4 text-green-600 bg-gray-100 border-gray-300 rounded focus:ring-green-500 dark:focus:ring-green-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",id:"continue-inserting"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"continue-inserting",className:"text-sm font-medium text-green-900 dark:text-green-100",children:"Continua a rimanere in Inserimento Spese"}),e.jsx("p",{className:"text-xs text-green-700 dark:text-green-300 mt-1",children:"Se attivato, dopo ogni registrazione la form si resetta per inserire una nuova spesa"})]})]})}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6",children:[e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:a==="insert"?"I tuoi dati sono protetti automaticamente. Prima di salvare ogni spesa, aggiorniamo i tassi di cambio per garantire precisione.":"Le modifiche verranno salvate mantenendo il tasso di cambio originale della spesa."}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 mt-2",children:["ðŸ’¡ ",e.jsx("strong",{children:"Suggerimento:"})," Usa ",e.jsx("kbd",{className:"px-1 py-0.5 text-xs bg-blue-200 dark:bg-blue-800 rounded",children:"Ctrl+S"})," (o ",e.jsx("kbd",{className:"px-1 py-0.5 text-xs bg-blue-200 dark:bg-blue-800 rounded",children:"Cmd+S"})," su Mac) per salvare rapidamente"]})]}),Q&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-800 dark:text-red-200",children:Q})}),e.jsxs("form",{onSubmit:q,onKeyDown:ae,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(X,{className:"h-4 w-4 inline mr-1"}),"Importo *"]}),e.jsx("input",{ref:N,type:"number",step:"0.01",value:t.amount,onChange:r=>w("amount",r.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${i.amount?"border-red-500":"border-gray-300 dark:border-gray-600"}`,placeholder:"0.00",id:"amount-input","aria-describedby":i.amount?"amount-error":""}),i.amount&&e.jsx("p",{className:"text-red-500 text-sm mt-1",id:"amount-error",children:i.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Valuta"}),e.jsx("select",{value:t.currency,onChange:r=>w("currency",r.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",id:"currency-select",children:Ee.map(r=>e.jsxs("option",{value:r.code,children:[r.symbol," ",r.code]},r.code))}),t.currency!=="EUR"&&e.jsx("div",{className:"mt-2 text-sm",children:re?e.jsxs("div",{className:"flex items-center text-amber-600 dark:text-amber-400",children:[e.jsx(B,{className:"h-3 w-3 animate-spin mr-1"}),e.jsx("span",{children:"Caricamento tasso di cambio..."})]}):j?.rate?e.jsxs("div",{className:"flex items-center text-green-600 dark:text-green-400",children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),e.jsxs("span",{children:["Tasso: 1 ",t.currency," = ",ke(j.rate,4)," EUR"]})]}):e.jsxs("div",{className:"flex items-center text-red-600 dark:text-red-400",children:[e.jsx("span",{className:"text-xs",children:"âš ï¸"}),e.jsx("span",{className:"ml-1",children:"Tasso non disponibile - sarÃ  usato 1.0"})]})})]})]}),e.jsxs("div",{className:"relative",ref:$,children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(he,{className:"h-4 w-4 inline mr-1"}),"Categoria *"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>R(!h),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white text-left flex items-center justify-between ${i.categoryId?"border-red-500":"border-gray-300"}`,"aria-haspopup":"listbox","aria-expanded":h,"aria-describedby":i.categoryId?"category-error":"",children:[e.jsx("div",{className:"flex items-center gap-2",children:D?e.jsxs(e.Fragment,{children:[(()=>{const r=_(D.icon);return e.jsx(r,{className:"h-4 w-4 text-gray-600 dark:text-gray-300"})})(),e.jsx("span",{children:D.name}),D.description&&e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["- ",D.description]})]}):e.jsx("span",{className:"text-gray-500",children:"Seleziona una categoria"})}),e.jsx(xe,{className:`h-4 w-4 text-gray-400 transition-transform ${h?"rotate-180":""}`})]}),h&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-80 overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-gray-200 dark:border-gray-600",children:[e.jsx("input",{ref:z,type:"text",placeholder:"Cerca categoria per nome...",value:p,onChange:r=>I(r.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-500 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-600 dark:text-white",id:"category-search","aria-label":"Cerca categoria",onKeyDown:r=>{r.key==="Escape"?(r.stopPropagation(),I(""),R(!1)):r.key==="Enter"&&y.length===1&&y[0]&&(r.preventDefault(),w("categoryId",y[0].id.toString()),R(!1),I(""))}}),p&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[y.length," categoria",y.length!==1?"e":""," trovata",y.length!==1?"e":""]})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:y.length>0?y.map(r=>{const o=_(r.icon);return e.jsxs("button",{type:"button",onClick:()=>{w("categoryId",r.id.toString()),R(!1),I("")},className:"w-full px-3 py-2 text-left hover:bg-gray-50 dark:hover:bg-gray-600 flex items-center gap-2 border-b border-gray-100 dark:border-gray-600 last:border-b-0",children:[e.jsx(o,{className:"h-4 w-4 text-gray-600 dark:text-gray-300"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:p?e.jsx("span",{dangerouslySetInnerHTML:{__html:r.name.replace(new RegExp(`(${p})`,"gi"),'<mark class="bg-yellow-200 dark:bg-yellow-600">$1</mark>')}}):r.name}),r.description&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:p?e.jsx("span",{dangerouslySetInnerHTML:{__html:r.description.replace(new RegExp(`(${p})`,"gi"),'<mark class="bg-yellow-200 dark:bg-yellow-600">$1</mark>')}}):r.description})]})]},r.id)}):e.jsxs("div",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:[e.jsx("div",{className:"text-sm",children:"Nessuna categoria trovata"}),p&&e.jsx("div",{className:"text-xs mt-1",children:"Prova a cercare con termini diversi"})]})})]})]}),i.categoryId&&e.jsx("p",{className:"text-red-500 text-sm mt-1",id:"category-error",children:i.categoryId})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(je,{className:"h-4 w-4 inline mr-1"}),"Data *"]}),e.jsx("input",{type:"date",value:t.date,onChange:r=>w("date",r.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white ${i.date?"border-red-500":"border-gray-300 dark:border-gray-600"}`,id:"date-input","aria-describedby":i.date?"date-error":""}),i.date&&e.jsx("p",{className:"text-red-500 text-sm mt-1",id:"date-error",children:i.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(Ne,{className:"h-4 w-4 inline mr-1"}),"Descrizione (opzionale)"]}),e.jsx("textarea",{value:t.description,onChange:r=>w("description",r.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white resize-none",placeholder:"Aggiungi una descrizione...",maxLength:200,id:"description-textarea","aria-describedby":"description-counter"}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",id:"description-counter",children:[t.description.length,"/200 caratteri"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-6",children:[e.jsxs("button",{type:"button",onClick:()=>b({to:"/expenses"}),className:"flex-1 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 px-6 py-3 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors flex items-center justify-center","aria-label":"Annulla e torna alla lista spese",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Annulla"]}),e.jsx("button",{type:"submit",disabled:d||Y,className:"flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:d?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4 animate-spin mr-2"}),Y?"Aggiornando valute...":a==="insert"?"Salvando...":"Aggiornando..."]}):me})]})]})]}),(!u||u.length===0)&&e.jsx("div",{className:"mt-6 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-amber-800 dark:text-amber-200 text-sm",children:[e.jsx("strong",{children:"Nessuna categoria disponibile."})," Prima di aggiungere spese,",e.jsx("a",{href:"/categories",className:"underline ml-1",children:"crea almeno una categoria"}),"."]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Z,{className:"h-8 w-8 text-green-600 dark:text-green-400"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:a==="insert"?"Spesa Salvata!":"Spesa Aggiornata!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a==="insert"?"La tua spesa Ã¨ stata registrata con successo.":"Le modifiche sono state salvate con successo."})]})}),e.jsx(ye,{isOpen:ie,onSaveAndExit:de,onExitWithoutSaving:ce,onCancel:le,isSaving:d,message:a==="insert"?"Hai inserito dei dati per una nuova spesa. Vuoi salvarla prima di uscire?":"Hai modificato questa spesa. Vuoi salvare le modifiche prima di uscire?",showSaveButton:!0})]})})}export{Ae as E};
