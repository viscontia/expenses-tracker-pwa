import{r as d,j as e,b as U,a as w,t as S}from"./index-DRQOx_Xf.js";import{u as z,U as R,a as A,T as L}from"./UnsavedChangesModal-WPjUveF1.js";import{C,A as F,D as O}from"./dollar-sign-Bgq7nrk_.js";import{C as T}from"./calendar-D2ZVVomX.js";import{F as M}from"./file-text-GkSa6YAt.js";import{L as $}from"./loader-circle-CIeghaF9.js";import"./createLucideIcon-BKpj3lx_.js";import"./x-DeAad_EH.js";function P({children:k,showIndicator:g=!1,indicatorClassName:x="",formData:b,onSave:s,isSaving:o,disabled:f,message:a}){const h={formData:b,onSave:s,isSaving:o,disabled:f,message:a},{hasUnsavedChanges:t,isModalOpen:m,confirmNavigation:i,cancelNavigation:l,saveAndNavigate:p}=z(h);return d.useEffect(()=>{const y=n=>{(n.ctrlKey||n.metaKey)&&n.key==="s"&&(n.preventDefault(),t&&s&&s())};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[t,s]),e.jsxs("div",{className:`relative ${x}`,children:[g&&t&&e.jsx("div",{className:"absolute top-0 right-0 z-10 transform translate-x-1/2 -translate-y-1/2",children:e.jsxs("div",{className:"flex items-center space-x-2 bg-amber-100 dark:bg-amber-900/20 text-amber-800 dark:text-amber-200 px-3 py-1 rounded-full text-xs font-medium border border-amber-200 dark:border-amber-800 shadow-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Modifiche non salvate"})]})}),k,s?e.jsx(R,{isOpen:m,onSaveAndExit:p,onExitWithoutSaving:i,onCancel:l,isSaving:o,message:a}):e.jsx(A,{isOpen:m,onExitWithoutSaving:i,onCancel:l,message:a})]})}const E=[{code:"EUR",name:"Euro",symbol:"‚Ç¨"},{code:"USD",name:"US Dollar",symbol:"$"},{code:"GBP",name:"British Pound",symbol:"¬£"},{code:"ZAR",name:"South African Rand",symbol:"R"}],q=function(){const g=U(),x=w(r=>r.token),b=w(r=>r.user?.preferences?.defaultCurrency),{data:s,isLoading:o}=S.categories.getAll.useQuery(void 0,{enabled:!!x}),f=S.expenses.createExpense.useMutation({onSuccess:()=>{y(!0),setTimeout(()=>{g({to:"/dashboard"})},2e3)},onError:r=>{v(r.message),l(!1)}}),[a,h]=d.useState({amount:"",currency:"EUR",categoryId:"",date:new Date().toISOString().split("T")[0]||new Date().toISOString().slice(0,10),description:""}),[t,m]=d.useState({}),[i,l]=d.useState(!1),[p,y]=d.useState(!1),[n,v]=d.useState(null);d.useEffect(()=>{const r=String(b||"EUR");h(c=>({...c,currency:r}))},[b]);const I=()=>{const r={};return(!a.amount||parseFloat(a.amount)<=0)&&(r.amount="L'importo deve essere maggiore di 0"),a.categoryId||(r.categoryId="Seleziona una categoria"),a.date||(r.date="Seleziona una data"),m(r),Object.keys(r).length===0},N=async()=>{if(!I())throw new Error("Il form contiene errori di validazione");if(!x)throw new Error("Token di autenticazione mancante");try{const r=(a.currency==="EUR",1);await f.mutateAsync({categoryId:parseInt(a.categoryId),amount:parseFloat(a.amount),currency:a.currency,conversionRate:r,date:new Date(a.date).toISOString(),description:a.description||void 0})}catch(r){throw r}},D=async r=>{r.preventDefault(),v(null),l(!0);try{await N()}catch(c){v(c instanceof Error?c.message:"Errore durante il salvataggio"),l(!1)}},u=(r,c)=>{h(j=>({...j,[r]:c})),t[r]&&m(j=>({...j,[r]:void 0}))};return p?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center px-4",children:e.jsx("div",{className:"max-w-md w-full text-center",children:e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-6",children:[e.jsx(C,{className:"h-12 w-12 text-green-600 dark:text-green-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-green-900 dark:text-green-100 mb-2",children:"Spesa salvata!"}),e.jsx("p",{className:"text-green-700 dark:text-green-300 mb-4",children:"La tua spesa √® stata registrata con successo."}),e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Reindirizzamento alla dashboard in corso..."})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8 px-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[e.jsx("button",{onClick:()=>g({to:"/dashboard"}),className:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(F,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Nuova Spesa"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Registra una nuova spesa nel tuo budget"})]})]}),e.jsx(P,{formData:a,onSave:N,isSaving:i,disabled:p,showIndicator:!0,message:"Hai inserito dei dati per una nuova spesa. Vuoi salvarla prima di uscire?",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsxs("form",{onSubmit:D,className:"p-6 space-y-6",children:[n&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:n})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(O,{className:"h-4 w-4 inline mr-1"}),"Importo *"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",value:a.amount,onChange:r=>u("amount",r.target.value),className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors
                      ${t.amount?"border-red-300 dark:border-red-600 bg-red-50 dark:bg-red-900/20":"border-gray-300 dark:border-gray-600 dark:bg-gray-700"} dark:text-white`,placeholder:"0.00"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:E.find(r=>r.code===a.currency)?.symbol})})]}),t.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:t.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Valuta"}),e.jsx("select",{value:a.currency,onChange:r=>u("currency",r.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white transition-colors",children:E.map(r=>e.jsxs("option",{value:r.code,children:[r.symbol," ",r.name," (",r.code,")"]},r.code))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(L,{className:"h-4 w-4 inline mr-1"}),"Categoria *"]}),e.jsxs("select",{value:a.categoryId,onChange:r=>u("categoryId",r.target.value),className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors
                    ${t.categoryId?"border-red-300 dark:border-red-600 bg-red-50 dark:bg-red-900/20":"border-gray-300 dark:border-gray-600 dark:bg-gray-700"} dark:text-white`,disabled:o,children:[e.jsx("option",{value:"",children:o?"Caricamento...":"Seleziona una categoria"}),s?.map(r=>e.jsx("option",{value:r.id.toString(),children:r.name},r.id))]}),t.categoryId&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:t.categoryId})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(T,{className:"h-4 w-4 inline mr-1"}),"Data *"]}),e.jsx("input",{type:"date",value:a.date,onChange:r=>u("date",r.target.value),className:`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors
                    ${t.date?"border-red-300 dark:border-red-600 bg-red-50 dark:bg-red-900/20":"border-gray-300 dark:border-gray-600 dark:bg-gray-700"} dark:text-white`}),t.date&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:t.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(M,{className:"h-4 w-4 inline mr-1"}),"Descrizione"]}),e.jsx("textarea",{value:a.description,onChange:r=>u("description",r.target.value),rows:3,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white transition-colors resize-none",placeholder:"Descrizione opzionale della spesa..."})]}),e.jsx("div",{className:"pt-4",children:e.jsx("button",{type:"submit",disabled:i||o,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium py-3 px-6 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:i?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Salvando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx("span",{children:"Salva Spesa"})]})})}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("div",{className:"flex-shrink-0 w-2 h-2 bg-blue-500 rounded-full mt-2"}),e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400",children:[e.jsx("p",{className:"font-medium mb-1",children:"üõ°Ô∏è Protezione dati attiva"}),e.jsx("p",{children:"I tuoi dati sono protetti automaticamente. Se tenti di uscire con modifiche non salvate, ti verr√† chiesto di confermare."}),e.jsxs("p",{className:"mt-1",children:[e.jsx("strong",{children:"Tip:"})," Usa ",e.jsx("kbd",{className:"px-1 py-0.5 bg-blue-200 dark:bg-blue-800 rounded",children:"Ctrl+S"})," per salvare rapidamente"]})]})]})})]})})})]})})};export{q as component};
